%Review of existing harmonic excitation.
%	Nonlinear Systems
%		Traditional Metrics (THD, IMD)
%		Minimisation of Nonlinear Distortion
%		Advent of "Nonlinear Niceness"
%	Timbre of nonlinear distortions (Martens and Marui type shit)
%	Uses of Harmonic Excitation
%	Harmonic Generation Methods
%		Static Nonlinearities
%		Bandwidth Extension (high frequency reconstruction)
%		Individual Harmonic Generation (SMC paper)
%		Psychoacoustic Enhancers

\chapter{Harmonic Excitation}
\label{chap:Excitation}

\section{Introduction}
\label{sec:Excitation-Introduction}
	\note{Harmonic excitation is of the chain. Look I wrote a paper about it \citep{enderby2013methods}.}

\section{Nonlinear Systems}
\label{sec:Excitation-NonlinearSystems}
	\note
	{
		THD and IMD are rubbish but served some purpose in the olden days. Some more metrics were made but they 
		were still only concerned with minimising distortion \citep{lee2003auditory, geddes2003auditory, 
		tan2004predicting}. \citet{voishvillo2006assessment} summarises a lot of metrics nicely. Then some bloke 
		decided distortion was cool.
	}

\section{Timbre of Nonlinear Distortion}
\label{sec:Excitation-Timbre}
	\note
	{
		Marui and Martens did some of this \citep{marui2005timbre, marui2005constructing, marui2005predicting}.
	}

\section{Uses of Harmonic Excitation}
\label{sec:Excitation-Uses}
	\note
	{
		Psychoacoustic reproduction of low frequency signals on small loudspeakers as done by 
		\citet{larsen2002reproducing} and \citet{gan2001virtual}.

		Reconstruction of high frequency components after lossy data compression \citep{friedrich2007spectral, 
		nagel2009a, nagel2010a, valin2000bandwidth, dietz2002spectral, larsen2002efficient, sha2010high}.

		Applications in increasing the intelligibility of speech.
	}

\section{Evaluation Methodology}
\label{sec:Excitation-Evaluation}
	\note
	{
		\begin{itemize}
			\item Low Complexity.
			\item Predictable, consistent behaviour (homogeneity).
			\item Spectral Characteristics.
			\item Temporal Characteristics.
			\item Preservation of harmonicity (low IMD).
			\item Control over order of harmonics generated.
			\item Naturalness of generated harmonics.
		\end{itemize}
	}

\section{Harmonic Generation Methods}
\label{sec:Excitation-Methods}
	\note{I like to generate harmonics, basically a nonlinear process}

	\subsection{Static Nonlinearities}
	\label{sec:Excitation-Statics}
		Static nonlinearities are simple mappings between input value and output value. A nonlinear function is
		applied individually to each sample of a signal. 
		
		A very simple class of static nonlinearities is the peak clipper. Peak clippers are typically piecewise
		functions comprising of three sections:

		\begin{enumerate}
			\item A linear section.
			\item A transition section, often called the `knee'.
			\item A clipping section.
		\end{enumerate}

		\begin{equation}
			y(n) = \begin{cases}
				t\sgn(x(n)) & \text{if $|x(n)| > t$} \\
				x(n) & \text{otherwise}
			\end{cases}
			\label{eq:SymmetricHardClipping}
		\end{equation}

		Where $t$ is the threshold value at which to clip the signal.

		\begin{equation}
			\large
			y(n) = \begin{cases}
				t\sgn(x(n)) & \text{if $|x(n)| > t$} \\
				t\sgn(x(n))\frac{3 - \left(2 - \left|\frac{2}{t}x(n) \right| \right)^{2}}{3} & \text{if
					$\frac{t}{2} \leq |x(n)| \leq t$} \\
				\frac{4x(n)}{3} & \text{otherwise}
			\end{cases}
			\label{eq:SymmetricSoftClipping}
		\end{equation}

		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.6\textwidth]{chapter3/Images/Clipping.eps}
			\caption{Hard and Soft clipping characteristics}
			\label{fig:Clipping}
		\end{figure}

		\subsubsection*{Complexity}
			Most static nonlinearities only involve a few simple operations for each sample of the input
			signal. The hard clipper from Equation \ref{eq:SymmetricHardClipping} involves only comparisons and
			assignments. A soft clipper \note{Refer to equation} could also involve some multiplication and
			addition.
			
			As each sample is processed individually these algorithms have linear complexity.

		\subsubsection*{Homogeneity}
			The homogeneity of a static nonlinearity depends on the nonlinear function used. 
			\note{DAFx Paper}

			The inhomogeneity of simple clipping systems can be counteracted by introducing gain stages either
			side of the clipping stage. The first gain stage scales the signal so that the clipping stage will
			always clip the same proportion of the signal. The second gain stage scales the signal back to the
			original input amplitude. Analogously the clipping function can be scaled so as to always clip the
			same proportion of the signal, as done by \citet{deman2014adaptive}.

		\subsubsection*{Spectral Characteristics}
			The spectral characteristics depend on the function applied to the signal. If an odd function is
			used only odd order intermodulation components will be produced. Using an even function only even
			order components are generated. If the function is neither odd nor even both odd and even order
			intermodulation components will be produced.

		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Rectification}
	\label{sec:Excitation-Rectification}
		Rectification is a special case of static nonlinearity. Signals can be either half or full wave rectified,
		as shown in Equations \ref{eq:HalfWaveRectification} and \ref{eq:FullWaveRectification} respectively.

		\begin{equation}
			y(n) = \begin{cases}
				0 & \text{if $x(n) < 0$} \\
				x(n) & \text{otherwise}
			\end{cases}
			\label{eq:HalfWaveRectification}
		\end{equation}

		\begin{equation}
			y(n) = |x(n)|
			\label{eq:FullWaveRectification}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Integrator}
	\label{sec:Excitation-Integrator}
		Equation \ref{eq:Integrator} shows an Integrator adapted from the one described by \citet{larsen2004audio}.

		\begin{equation}
			y(n) = \begin{cases}
				0 & \text{if $x(n) > 0$ and $x(n - 1) \leq 0$} \\
				y(n - 1) + c|x(n)| & \text{otherwise}
			\end{cases}
			\label{eq:Integrator}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Multiplier}
	\label{sec:Excitation-Multiplier}
		\begin{equation}
			y(n) = x(n)^{h}, \quad h \in \mathbb{N}
			\label{eq:Multiplier}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Single Side Band Automodulation}
	\label{sec:Excitation-SSB}
		Single sideband automodulation utilises the concept of single sideband modulation
		\citep{corinthios2009signals}. This allows you to apply amplitude modulation to a signal and only produce
		either the sum or difference sideband.

		A simple way to apply single sideband modulation to a signal is through construction of an analytic signal.
		An analytic signal is a complex valued signal, the real part of which is the original signal and the
		imaginary part its Hilbert transform. The analytic signal is often denoted with a subscript letter
		$a$, such that the analytic representation of the signal $x(n)$ would be denoted $x_{a}(n)$.

		\note
		{
			We probably need some place to talk about hilbert transforms \citet{oppenheim2014discrete} are
			pretty good at that shiz.
		}

		In single sideband automodulation the analytical representation of the input signal is multiplied with
		itself in order to generate harmonics. Equation \ref{eq:SSB} shows the $h^{\text{th}}$ order single side
		band automodulation of a signal.

		\begin{equation}
			y(n) = \Re \left( x_{a}(n)^{h} \right), \quad h \in \mathbb{N}
			\label{eq:SSB}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Instantaneous Amplitude and Phase}
	\label{sec:Excitation-IAP}
		In this method, the instantaneous amplitude and phase of the analytic signal are calculated. These values
		are then used to aid in the construction of harmonics. The instantaneous amplitude of the analytic signal
		is found by taking its absolute value, $|x_{a}(n)|$. The instantaneous phase is found by taking the complex
		argument of the analytic signal, $\arg(x_{a}(n))$. The instantaneous phase can then be scaled in order to
		scale the frequency content of the signal independent of its amplitude. Equation \ref{eq:IAP} shows the
		$h^{\text{th}}$ order instantaneous amplitude and phase modulation of a signal.

		\begin{equation}
			y(n) = |x_{a}(n)| \cos \left( h\arg(x_{a}(n)) \right), \quad h \in \mathbb{N}
			\label{eq:IAP}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Spectral Replication}
	\label{sec:Excitation-SpectralReplication}
		The principle behind spectral replication is to reproduce the spectral structure of a signal at higher
		frequencies.

		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.6\textwidth]{chapter3/Images/SpectralReplication.eps}
			\caption{The spectral characteristics of spectral replication.}
			\label{fig:SpectralReplication}
		\end{figure}

		This spectral shift is easily implemented through the use of single side band modulation as shown in
		Equation \ref{eq:SpectralReplication}.

		\begin{equation}
			y(n) = \Re \left( x_{a}(n) e^{j\omega  n/ f_{s}} \right)
			\label{eq:SpectralReplication}
		\end{equation}

		Where $\omega$ is the angular frequency the signal should be shifted by and $f_{s}$ is the sampling
		frequency of the signal.

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Spectral Folding}
	\label{sec:Excitation-SpectralFolding}
	
		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.6\textwidth]{chapter3/Images/SpectralFolding.eps}
			\caption{The spectral characteristics of spectral folding.}
			\label{fig:SpectralFolding}
		\end{figure}

		\begin{equation}
			y(n) = \begin{cases}
				-x(n) & \text{if $n$ is odd} \\
				x(n) & \text{otherwise}
			\end{cases}
			\label{eq:SpectralFolding}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Spectral Stretching}
	\label{sec:Excitation-SpectralStretching}

		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.6\textwidth]{chapter3/Images/SpectralStretching.eps}
			\caption{The spectral characteristics of spectral stretching.}
			\label{fig:SpectralStretching}
		\end{figure}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	%\subsection{Bandwidth Extension}
	%\label{sec:Excitation-BWE}
	%	\note
	%	{
	%		A nice summary in \citet{larsen2004audio}.

	%		Look at Figure \ref{fig:SpectralFolding} 'aint it fancy.
	%	}

	%	\begin{figure}[h!]
	%		\centering
	%		\subfloat[Spectral Folding]
	%		{\includegraphics[width=0.4\textwidth]{chapter3/Images/SpectralFolding.png}}
	%		\subfloat[Spectral Replication]
	%		{\includegraphics[width=0.4\textwidth]{chapter3/Images/SpectralReplication.png}}
	%		\\
	%		\subfloat[Spectral Stretching]
	%		{\includegraphics[width=0.4\textwidth]{chapter3/Images/SpectralStretching.png}}
	%		\caption{Spectral characteristics of different band width extension methods. In each graph the blue 
	%		section represents the original spectra and the red section the new spectral content.}
	%		\label{fig:SpectralFolding}
	%	\end{figure}

	\subsection{Individual Harmonic Generation}
	\label{sec:Excitation-Individuals}
		\note{SMC paper}

	\subsection{Psychoacoustic Enhancers}
	\label{sec:Excitation-Enhancers}
		\note
		{
			Probably the most well known perceptual control effects out there. The Aural Exciter has been 
			covered by both \citet{chalupper2000aural} and \citet{shekar2013modeling}.
		}

	\subsection{Fundamental Frequency Tracking}
	\label{sec:Excitation-Fundamental}
		\note
		{
			Several generation methods can be improved through tracking the fundamental frequency of the input 
			signal.

			We can talk all about fundamental / pitch tracking here \citep{cuadra2001efficient, 
			gerhard2003pitch, prukkanon2009vt-amdf, larsen2004audio}.
		}

\begin{landscape}
\section{Methods Comparison}
\label{sec:Excitation-Comparison}

	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		\bf{Method} & \bf{Complexity} & \bf{Homogeneity} & \bf{Spectral Properties} & \bf{Temporal Properties} & \bf{IMD}
		\bf{Flexibility} & \bf{Naturalness} \\
		\hline
		Static Nonlinearity & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Rectifier & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Integrator & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Multiplier & $\mathcal{O}(n)$ & & & & & \\
		\hline
		SSB & $\mathcal{O}(n)$ & & & & & \\
		\hline
		IAP & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Spectral Replicator & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Spectral Mirror & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Spectral Stretch & $\mathcal{O}(n\log{n})$ Assuming FFT used & & & & & \\
		\hline
	\end{tabular}

\end{landscape}
