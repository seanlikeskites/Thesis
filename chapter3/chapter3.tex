%Review of existing harmonic excitation.
%	Nonlinear Systems
%		Traditional Metrics (THD, IMD)
%		Minimisation of Nonlinear Distortion
%		Advent of "Nonlinear Niceness"
%	Timbre of nonlinear distortions (Martens and Marui type shit)
%	Uses of Harmonic Excitation
%	Harmonic Generation Methods
%		Static Nonlinearities
%		Bandwidth Extension (high frequency reconstruction)
%		Individual Harmonic Generation (SMC paper)
%		Psychoacoustic Enhancers

\chapter{Harmonic Excitation}
\label{chap:Excitation}

\section{Introduction}
\label{sec:Excitation-Introduction}
	\note{Harmonic excitation is of the chain. Look I wrote a paper about it \citep{enderby2013methods}.}

\section{Nonlinear Systems}
\label{sec:Excitation-NonlinearSystems}
	\note
	{
		THD and IMD are rubbish but served some purpose in the olden days. Some more metrics were made but they 
		were still only concerned with minimising distortion \citep{lee2003auditory, geddes2003auditory, 
		tan2004predicting}. \citet{voishvillo2006assessment} summarises a lot of metrics nicely. Then some bloke 
		decided distortion was cool.
	}

\section{Timbre of Nonlinear Distortion}
\label{sec:Excitation-Timbre}
	\note
	{
		Marui and Martens did some of this \citep{marui2005timbre, marui2005constructing, marui2005predicting}.
	}

\section{Uses of Harmonic Excitation}
\label{sec:Excitation-Uses}
	\note
	{
		Psychoacoustic reproduction of low frequency signals on small loudspeakers as done by 
		\citet{larsen2002reproducing} and \citet{gan2001virtual}.

		Reconstruction of high frequency components after lossy data compression \citep{friedrich2007spectral, 
		nagel2009a, nagel2010a, valin2000bandwidth, dietz2002spectral, larsen2002efficient, sha2010high}.

		Applications in increasing the intelligibility of speech.
	}

\section{Evaluation Methodology}
\label{sec:Excitation-Evaluation}
	There are many different classes of nonlinear system which are used in audio processing. Each of these has its own
	characteristics. There are several properties to look at when evaluating a nonlinear system for use in real time
	timbral control. These are:

	\begin{itemize}
		\item Low Complexity.
		\item Homogeneity
		\item Spectral Characteristics.
		\item Temporal Characteristics.
		\item Inharmonic Distortion.
		\item Flexibility.
		\item Naturalness.
	\end{itemize}

	The following sections will discuss what behaviour is desirable in these areas.

	\subsection{Complexity}
	\label{sec:Excitation-Evaluation-Complexity}
		\note
		{
			Some guff about real time stuff. Could probably also mention how much latency in introduced due to
			filter buffers and such.
		}
	
	\subsection{Homogeneity}
	\label{sec:Excitation-Evaluation-Homogeneity}
		A homogeneous system is one whose behaviour does not depend on the input amplitude of the input.  Where $f$
		is a homogeneous system we have:

		\[ f(ax) = af(x) \]

		Where $a$ is some scaling factor of the input $x$.
		
		Nonlinear systems are typically non-homogeneous. This is undesirable when using them to achieve timbral
		control as it means the effects are less easy to predict. Different timbral transformations could be applied
		to the same signal if its amplitude is changed slightly. From a user point of view this makes control of the
		system less intuitive as control parameters can change function depending on signal level.

		There do exist homogeneous nonlinear systems. These are a minority however and lack some of the desirable
		features that some non-homogeneous systems have. In some cases steps can be taken to make non-homogeneous
		systems homogeneous. These will be discussed where appropriate in Section \ref{sec:Excitation-Methods}

	\subsection{Spectral Characteristics}
	\label{sec:Excitation-Evaluation-SpectralCharacteristics}
		All the systems discussed in this chapter introduce new spectral content to a signal. 

		\note
		{
			Some introduce large blocks of harmonics, some single harmonics. Does this overlap with the
			flexibility section?
		}

	\subsection{Temporal Characteristics}
	\label{sec:Excitation-Evaluation-TemporalCharacteristics}
		As discussed in Section \ref{sec:Timbre-Features} one of the properties of a signal which
		contributes to its timbre is how it evolves over time.

		How a system affects these temporal characteristics is necessary to know in order to describe the timbral
		transformation it applies. As discussed in Section \ref{sec:Excitation-Evaluation-Homogeneity} control
		parameters will be more intuitive if the alteration to a signals temporal characteristics are not dependant
		on the input amplitude.

	\subsection{Inharmonic Distortion}
	\label{sec:Excitation-Evaluation-InharmonicDistortion}
		\note{IMD}

	\subsection{Flexibility}
	\label{sec:Excitation-Evaluation-Flexibility}

	\subsection{Naturalness}
	\label{sec:Excitation-Evaluation-Naturalness}

\section{Harmonic Generation Methods}
\label{sec:Excitation-Methods}
	\note{I like to generate harmonics, basically a nonlinear process}

	\subsection{Static Nonlinearities}
	\label{sec:Excitation-Statics}
		Static nonlinearities are simple mappings between input value and output value. A nonlinear function is
		applied individually to each sample of a signal. They can be described by a characteristic curves which
		shows the relationship between input and output values.
		
		A very simple class of static nonlinearities is the peak clipper. This class of effects limits the
		magnitude of samples to being at or below a given clipping threshold value. Peak clippers are typically
		piecewise functions comprising of three sections:

		\begin{enumerate}
			\item A linear section. Applied to low magnitude samples.
			\item A transition section, often called the `knee'. This refers to the nonlinear part of the
				function for samples with magnitude below the clipping threshold.
			\item A clipping section. Limiting the magnitude of samples above the clipping threshold.
		\end{enumerate}

		One of the simplest peak clippers is the symmetric hard clipper shown in Equation
		\ref{eq:SymmetricHardClipping}.

		\begin{equation}
			y(n) = \begin{cases}
				t\sgn(x(n)) & \text{if $|x(n)| > t$} \\
				x(n) & \text{otherwise}
			\end{cases}, \quad t \geq 0
			\label{eq:SymmetricHardClipping}
		\end{equation}

		Where $t$ is the threshold value at which to clip the signal. Peak clippers are described as symmetric if
		the underlying function is odd. Clippers which use non odd functions are referred to as asymmetric.

		Equation \ref{eq:SymmetricHardClipping} describes a hard clipper due to the lack of a transition section.
		Soft clippers apply a nonlinear function to medium magnitude samples in order to smooth the transition
		between linear and clipping sections. Equation \ref{eq:SymmetricSoftClipping} shows a soft clipper adapted
		from one given by \citet{dutilleux2002nonlinear}. Figure \ref{fig:Clipping} shows the characteristic curves
		for the clippers given in Equations \ref{eq:SymmetricHardClipping} and \ref{eq:SymmetricSoftClipping}.

		\begin{equation}
			\large
			y(n) = \begin{cases}
				t\sgn(x(n)) & \text{if $|x(n)| > t$} \\
				t\sgn(x(n))\frac{3 - \left(2 - \left|\frac{2}{t}x(n) \right| \right)^{2}}{3} & \text{if
					$\frac{t}{2} \leq |x(n)| \leq t$} \\
				\frac{4x(n)}{3} & \text{otherwise}
			\end{cases}, \quad t \geq 0
			\label{eq:SymmetricSoftClipping}
		\end{equation}

		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.6\textwidth]{chapter3/Images/Clipping.eps}
			\caption{Characteristic curves for \ref{eq:SymmetricHardClipping} and
				 \ref{eq:SymmetricSoftClipping} with a threshold of 0.5.}
			\label{fig:Clipping}
		\end{figure}

		\subsubsection*{Complexity}
			Most static nonlinearities only involve a few simple operations for each sample of the input
			signal. The hard clipper from Equation \ref{eq:SymmetricHardClipping} involves only comparisons and
			assignments. A soft clipper could also involve some multiplication and addition.
			
			As each sample is processed individually these algorithms have linear complexity.

		\subsubsection*{Homogeneity}
			The homogeneity of a static nonlinearity depends on the nonlinear function used. For different
			input amplitudes the set of harmonics generated by a given static nonlinearity will change. The
			ways in which this set of harmonics changes was investigated by \citet{enderby2012harmonic}.

			In that study the effects of several soft clippers on sinusoidal inputs were analysed. The levels
			of individual harmonics are plotted as a function of input amplitude. Figures
			\ref{fig:HardClippingHarmonics} and \ref{fig:SoftClippingHarmonics} show these plots for the
			clipping functions described previously.

			\begin{figure}[h!]
				\centering
				\includegraphics[width=0.6\textwidth]{chapter3/Images/HardClippingHarmonics.eps}
				\caption{Individual harmonic distortion levels for Equation \ref{eq:SymmetricHardClipping}
					 with a threshold of 0.5.}
				\label{fig:HardClippingHarmonics}
			\end{figure}

			\begin{figure}[h!]
				\centering
				\includegraphics[width=0.6\textwidth]{chapter3/Images/SoftClippingHarmonics.eps}
				\caption{Individual harmonic distortion levels for Equation \ref{eq:SymmetricSoftClipping}
					 with a threshold of 0.5.}
				\label{fig:SoftClippingHarmonics}
			\end{figure}

			The first thing to note is that new harmonic components are only introduced once the input
			amplitude extends out of the linear section of the characteristic curve. Once input amplitude
			reaches a sufficient level harmonics are introduced but their amplitudes all vary independently.

			This behaviour can be improved on through the use of a different clipping function. Equation
			\ref{eq:SymmetricExponentialClipping} shows a function used to apply exponential clipping to a
			signal.
			
			\begin{equation}
				y(n) = \begin{cases}
					t\sgn(x(n)) & \text{if $|x(n)| > t$} \\
					t\sgn(x(n)) \left(1 - \left|\frac{x(n)}{t} - \sgn(x(n)) \right|^{E} \right) &
						\text{otherwise}
				\end{cases}, \quad t \geq 0 \ \text{and} \ E > 1
				\label{eq:SymmetricExponentialClipping}
			\end{equation}

			Where $E$ is a second parameter called the exponent. One advantage of this clipper is that it has
			no linear section. This means that harmonics are generated for input signals of any amplitude.
			Another advantage is that the levels of the generated harmonics vary more uniformly with input
			amplitude as shown in Figure \ref{fig:ExponentialClippingHarmonics}.

			\begin{figure}[h!]
				\centering
				\includegraphics[width=0.6\textwidth]{chapter3/Images/ExponentialClippingHarmonics.eps}
				\caption{Individual harmonic distortion levels for Equation
					 \ref{eq:SymmetricExponentialClipping} with a threshold of 0.5 and an 
				         exponent of 5.}
				\label{fig:ExponentialClippingHarmonics}
			\end{figure}

			The non-homogeneity of simple clipping systems can be counteracted by introducing gain stages either
			side of the clipping stage. The first gain stage scales the signal so that the clipping stage will
			always clip the same proportion of the signal. The second gain stage scales the signal back to the
			original input amplitude. Analogously the clipping function can be scaled so as to always clip the
			same proportion of the signal, as done by \citet{deman2014adaptive}.

		\subsubsection*{Spectral Characteristics}
			The spectral characteristics depend on the function applied to the signal. If an odd function is
			used only odd order intermodulation components will be produced. Using an even function only even
			order components are generated. 

			The symmetric clippers discussed previously all use odd functions. It is evident from the harmonic
			amplitude plots that only odd order harmonics have been introduced to the signal. In order to
			generate even order harmonics these clipping function needs to be made asymmetric. This is easily
			done by clipping negative and positive portions of the input signal at different thresholds.
			Equation \ref{eq:SymmetricHardClipping} can be modified to allow for asymmetric clipping giving
			Equation \ref{eq:AsymmetricHardClipping}.
			
			\begin{equation}
				y(n) = \begin{cases}
					t_{+} & \text{if $x(n) > t_{+}$} \\
					t_{-} & \text{if $x(n) < t_{-}$} \\
					x(n) & \text{otherwise}
				\end{cases}, \quad t_{-} < t_{+}
				\label{eq:AsymmetricHardClipping}
			\end{equation}

			Where $t_{+}$ and $t_{-}$ are the clipping thresholds for positive and negative portions of the
			signal respectively.	

			The amplitudes of the generated harmonics will roll off at differing rates depending on the
			properties of the output signal. The spectrum will roll off at $6(n+1)$dB per octave when the
			$n^{\text{th}}$ derivative of the output signal is discontinuous \citep{kraght2000aliasing}.

			Hard clippers introduce discontinuities to the first derivative of a signal and so will introduce
			harmonics whose amplitudes will roll off at 12dB per octave. Signals clipped by Equation
			\ref{eq:SymmetricSoftClipping} are continuous in the first derivative \todo{(check this)} and so
			produce harmonics which roll off at a faster rate. This can be seen in Figure
			\ref{fig:ClippingSpectra}.

			\begin{figure}[h!]
				\centering
				\includegraphics[width=0.6\textwidth]{chapter3/Images/ClippingSpectra.eps}
				\caption{Spectra of sinusoids clipped using Equations \ref{eq:SymmetricHardClipping} and
			                 \ref{eq:SymmetricSoftClipping}.}
				\label{fig:ClippingSpectra}
			\end{figure}

			The steeper roll off produced by soft clippers reduces the number of aliased frequencies produced.
			This is advantageous as aliased frequencies tend to be inharmonic.

		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Rectification}
	\label{sec:Excitation-Rectification}
		Rectification is a special case of static nonlinearity. Signals can be either half or full wave rectified,
		as shown in Equations \ref{eq:HalfWaveRectification} and \ref{eq:FullWaveRectification} respectively.

		\begin{equation}
			y(n) = \begin{cases}
				0 & \text{if $x(n) < 0$} \\
				x(n) & \text{otherwise}
			\end{cases}
			\label{eq:HalfWaveRectification}
		\end{equation}

		\begin{equation}
			y(n) = |x(n)|
			\label{eq:FullWaveRectification}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Integrator}
	\label{sec:Excitation-Integrator}
		Equation \ref{eq:Integrator} shows an Integrator adapted from the one described by \citet{larsen2004audio}.

		\begin{equation}
			y(n) = \begin{cases}
				0 & \text{if $x(n) > 0$ and $x(n - 1) \leq 0$} \\
				y(n - 1) + c|x(n)| & \text{otherwise}
			\end{cases}
			\label{eq:Integrator}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Multiplier}
	\label{sec:Excitation-Multiplier}
		\begin{equation}
			y(n) = x(n)^{h}, \quad h \in \mathbb{N}
			\label{eq:Multiplier}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Single Side Band Automodulation}
	\label{sec:Excitation-SSB}
		Single sideband automodulation utilises the concept of single sideband modulation
		\citep{corinthios2009signals}. This allows you to apply amplitude modulation to a signal and only produce
		either the sum or difference sideband.

		A simple way to apply single sideband modulation to a signal is through construction of an analytic signal.
		An analytic signal is a complex valued signal, the real part of which is the original signal and the
		imaginary part its Hilbert transform. The analytic signal is often denoted with a subscript letter
		$a$, such that the analytic representation of the signal $x(n)$ would be denoted $x_{a}(n)$.

		\note
		{
			We probably need some place to talk about hilbert transforms \citet{oppenheim2014discrete} are
			pretty good at that shiz.
		}

		In single sideband automodulation the analytical representation of the input signal is multiplied with
		itself in order to generate harmonics. Equation \ref{eq:SSB} shows the $h^{\text{th}}$ order single side
		band automodulation of a signal.

		\begin{equation}
			y(n) = \Re \left( x_{a}(n)^{h} \right), \quad h \in \mathbb{N}
			\label{eq:SSB}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Instantaneous Amplitude and Phase}
	\label{sec:Excitation-IAP}
		In this method, the instantaneous amplitude and phase of the analytic signal are calculated. These values
		are then used to aid in the construction of harmonics. The instantaneous amplitude of the analytic signal
		is found by taking its absolute value, $|x_{a}(n)|$. The instantaneous phase is found by taking the complex
		argument of the analytic signal, $\arg(x_{a}(n))$. The instantaneous phase can then be scaled in order to
		scale the frequency content of the signal independent of its amplitude. Equation \ref{eq:IAP} shows the
		$h^{\text{th}}$ order instantaneous amplitude and phase modulation of a signal.

		\begin{equation}
			y(n) = |x_{a}(n)| \cos \left( h\arg(x_{a}(n)) \right), \quad h \in \mathbb{N}
			\label{eq:IAP}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Spectral Replication}
	\label{sec:Excitation-SpectralReplication}
		The principle behind spectral replication is to reproduce the spectral structure of a signal at higher
		frequencies.

		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.6\textwidth]{chapter3/Images/SpectralReplicationSpectrum.eps}
			\caption{The spectral characteristics of spectral replication.}
			\label{fig:SpectralReplication}
		\end{figure}

		This spectral shift is easily implemented through the use of single side band modulation as shown in
		Equation \ref{eq:SpectralReplication}.

		\begin{equation}
			y(n) = \Re \left( x_{a}(n) e^{j\omega  n/ f_{s}} \right)
			\label{eq:SpectralReplication}
		\end{equation}

		Where $\omega$ is the angular frequency the signal should be shifted by and $f_{s}$ is the sampling
		frequency of the signal.

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Spectral Folding}
	\label{sec:Excitation-SpectralFolding}
	
		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.6\textwidth]{chapter3/Images/SpectralFoldingSpectrum.eps}
			\caption{The spectral characteristics of spectral folding.}
			\label{fig:SpectralFolding}
		\end{figure}

		\begin{equation}
			y(n) = \begin{cases}
				-x(n) & \text{if $n$ is odd} \\
				x(n) & \text{otherwise}
			\end{cases}
			\label{eq:SpectralFolding}
		\end{equation}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	\subsection{Spectral Stretching}
	\label{sec:Excitation-SpectralStretching}

		\begin{figure}[h!]
			\centering
			\includegraphics[width=0.6\textwidth]{chapter3/Images/SpectralStretchingSpectrum.eps}
			\caption{The spectral characteristics of spectral stretching.}
			\label{fig:SpectralStretching}
		\end{figure}

		\subsubsection*{Complexity}
		\subsubsection*{Homogeneity}
		\subsubsection*{Spectral Characteristics}
		\subsubsection*{Temporal Characteristics}
		\subsubsection*{Preservation of Harmonicity}
		\subsubsection*{Flexibility}
		\subsubsection*{Naturalness}

	%\subsection{Bandwidth Extension}
	%\label{sec:Excitation-BWE}
	%	\note
	%	{
	%		A nice summary in \citet{larsen2004audio}.

	%		Look at Figure \ref{fig:SpectralFolding} 'aint it fancy.
	%	}

	%	\begin{figure}[h!]
	%		\centering
	%		\subfloat[Spectral Folding]
	%		{\includegraphics[width=0.4\textwidth]{chapter3/Images/SpectralFolding.png}}
	%		\subfloat[Spectral Replication]
	%		{\includegraphics[width=0.4\textwidth]{chapter3/Images/SpectralReplication.png}}
	%		\\
	%		\subfloat[Spectral Stretching]
	%		{\includegraphics[width=0.4\textwidth]{chapter3/Images/SpectralStretching.png}}
	%		\caption{Spectral characteristics of different band width extension methods. In each graph the blue 
	%		section represents the original spectra and the red section the new spectral content.}
	%		\label{fig:SpectralFolding}
	%	\end{figure}

	\subsection{Individual Harmonic Generation}
	\label{sec:Excitation-Individuals}
		\note{SMC paper}

	\subsection{Psychoacoustic Enhancers}
	\label{sec:Excitation-Enhancers}
		\note
		{
			Probably the most well known perceptual control effects out there. The Aural Exciter has been 
			covered by both \citet{chalupper2000aural} and \citet{shekar2013modeling}.
		}

	\subsection{Fundamental Frequency Tracking}
	\label{sec:Excitation-Fundamental}
		\note
		{
			Several generation methods can be improved through tracking the fundamental frequency of the input 
			signal.

			We can talk all about fundamental / pitch tracking here \citep{cuadra2001efficient, 
			gerhard2003pitch, prukkanon2009vt-amdf, larsen2004audio}.
		}

\begin{landscape}
\section{Methods Comparison}
\label{sec:Excitation-Comparison}

	\begin{tabular}{|c|c|c|c|c|c|c|}
		\hline
		\bf{Method} & \bf{Complexity} & \bf{Homogeneity} & \bf{Spectral Properties} & \bf{Temporal Properties} & \bf{IMD}
		\bf{Flexibility} & \bf{Naturalness} \\
		\hline
		Static Nonlinearity & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Rectifier & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Integrator & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Multiplier & $\mathcal{O}(n)$ & & & & & \\
		\hline
		SSB & $\mathcal{O}(n)$ & & & & & \\
		\hline
		IAP & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Spectral Replicator & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Spectral Mirror & $\mathcal{O}(n)$ & & & & & \\
		\hline
		Spectral Stretch & $\mathcal{O}(n\log{n})$ Assuming FFT used & & & & & \\
		\hline
	\end{tabular}

\end{landscape}
